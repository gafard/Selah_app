# üìè GUIDE - Reading Sizer

**Version** : 1.0  
**Date** : 9 Octobre 2025  
**Compl√©ment** : ChapterIndex + S√©mantique v2.0

---

## ‚ö° EN 30 SECONDES

Module intelligent pour calculer **combien de chapitres lire par jour** selon une **dur√©e cible en minutes**.

**Input** : Livre + Minutes/jour  
**Output** : Plan jour par jour avec estimations pr√©cises

---

## üéØ OBJECTIF

R√©soudre : *"Je veux lire Luc en 40 jours avec 10 min/jour, combien de chapitres par jour ?"*

**AVANT** (approximation) :
```dart
final chaptersPerDay = 24 / 40; // = 0.6 chapitre/jour ‚ùå
// Tous les chapitres = 25 versets ‚ùå
// Densit√© uniforme ‚ùå
```

**APR√àS** (ReadingSizer) :
```dart
final plan = ReadingSizer.generateReadingPlan(
  book: 'Luc',
  totalChapters: 24,
  targetMinutesPerDay: 10,
);
// ‚Üí 24 jours avec chapitres adapt√©s ‚úÖ
// ‚Üí Versets r√©els ‚úÖ
// ‚Üí Densit√© calibr√©e ‚úÖ
```

---

## üì¶ API COMPL√àTE

### 1. `estimateChaptersForDay()`

**Usage** : Combien de chapitres pour atteindre N minutes ?

```dart
final chapters = ReadingSizer.estimateChaptersForDay(
  book: 'Luc',
  totalChapters: 24,
  targetMinutes: 10,
  startChapter: 1, // optionnel
);

print(chapters); // ‚Üí 2
// Luc 1 (80 versets) ‚âà 14 min ‚Üí d√©passe, mais on garde car 1er jour
// On s'arr√™te √† 1 chapitre si proche de la cible
```

**Logique** :
- Accumule chapitres jusqu'√† atteindre cible
- S'arr√™te si prochain chapitre d√©passe 130% de la cible
- Minimum 1 chapitre/jour

---

### 2. `dayReadingSummary()`

**Usage** : R√©sum√© d√©taill√© d'un jour de lecture

```dart
final summary = ReadingSizer.dayReadingSummary(
  book: 'Luc',
  startChapter: 1,
  totalChapters: 24,
  targetMinutes: 10,
);

print(summary);
// {
//   'chapters': 1,
//   'approxMinutes': 14,
//   'targetMinutes': 10,
//   'range': 'Luc 1',
//   'startChapter': 1,
//   'endChapter': 1,
//   'book': 'Luc'
// }
```

**Utilit√©** : Affichage UI preview

```dart
Text('üìñ ${summary['range']} ‚Äî ~${summary['approxMinutes']} min')
// ‚Üí "üìñ Luc 1 ‚Äî ~14 min"
```

---

### 3. `estimateTotalReadingMinutes()`

**Usage** : Temps total pour lire un livre entier

```dart
final total = ReadingSizer.estimateTotalReadingMinutes('Luc', 24);
print(total); // ‚Üí ~240 minutes (4h)

// Afficher dans UI
final hours = (total / 60).round();
Text('Temps total: ~${hours}h')
// ‚Üí "Temps total: ~4h"
```

---

### 4. `estimateDaysForBook()`

**Usage** : Nombre de jours n√©cessaires

```dart
final days = ReadingSizer.estimateDaysForBook(
  book: 'Luc',
  totalChapters: 24,
  targetMinutesPerDay: 10,
);

print(days); // ‚Üí ~24 jours
```

**Utilit√©** : Sugg√©rer dur√©e plan

```dart
Text('Dur√©e sugg√©r√©e: $days jours')
// ‚Üí "Dur√©e sugg√©r√©e: 24 jours"
```

---

### 5. `generateReadingPlan()` ‚≠ê

**Usage** : G√©n√©rer plan complet jour par jour

```dart
final plan = ReadingSizer.generateReadingPlan(
  book: 'Luc',
  totalChapters: 24,
  targetMinutesPerDay: 10,
);

// Afficher
for (final day in plan) {
  print('Jour ${day['dayNumber']}: ${day['range']} (~${day['approxMinutes']} min)');
}

// R√©sultat:
// Jour 1: Luc 1 (~14 min)
// Jour 2: Luc 2 (~11 min)
// Jour 3: Luc 3‚Äì4 (~12 min)
// ...
// Jour 24: Luc 24 (~11 min)
```

**Structure retourn√©e** :
```dart
[
  {
    'dayNumber': 1,
    'book': 'Luc',
    'startChapter': 1,
    'endChapter': 1,
    'chapters': 1,
    'approxMinutes': 14,
    'targetMinutes': 10,
    'range': 'Luc 1'
  },
  // ...
]
```

---

### 6. `adjustForReadingSpeed()`

**Usage** : Adapter selon vitesse utilisateur

```dart
final baseTarget = 10.0; // minutes

// Lecteur lent
final slow = ReadingSizer.adjustForReadingSpeed(baseTarget, 'slow');
print(slow); // ‚Üí 15 min (+50%)

// Lecteur rapide
final fast = ReadingSizer.adjustForReadingSpeed(baseTarget, 'fast');
print(fast); // ‚Üí 7 min (-30%)

// Normal
final normal = ReadingSizer.adjustForReadingSpeed(baseTarget, 'normal');
print(normal); // ‚Üí 10 min
```

**Int√©gration profil** :
```dart
final targetMinutes = ReadingSizer.adjustForReadingSpeed(
  userProfile.preferredMinutesPerDay,
  userProfile.readingSpeed, // 'slow', 'normal', 'fast'
);
```

---

### 7. `planStats()`

**Usage** : Statistiques sur un plan g√©n√©r√©

```dart
final plan = ReadingSizer.generateReadingPlan(...);
final stats = ReadingSizer.planStats(plan);

print(stats);
// {
//   'totalDays': 24,
//   'totalMinutes': 240,
//   'avgMinutesPerDay': 10,
//   'minDay': { dayNumber: 15, range: 'Luc 15', approxMinutes: 10 },
//   'maxDay': { dayNumber: 1, range: 'Luc 1', approxMinutes: 14 },
//   'variance': 4 // √©cart min-max
// }
```

**Affichage UI** :
```dart
Text('üìä Statistiques du plan')
Text('Jours: ${stats['totalDays']}')
Text('Temps total: ${stats['totalMinutes']}min (~${stats['totalMinutes'] ~/ 60}h)')
Text('Moyenne: ${stats['avgMinutesPerDay']}min/jour')
Text('√âcart: ${stats['variance']}min')
```

---

## üîå INT√âGRATION DANS LE G√âN√âRATEUR

### AVANT (approximation)

```dart
// intelligent_local_preset_generator.dart

final totalDays = userProfile.availableDays;
final chaptersPerDay = totalChapters / totalDays; // ‚ùå Approximation

for (int day = 0; day < totalDays; day++) {
  final startCh = (day * chaptersPerDay).floor() + 1;
  final endCh = ((day + 1) * chaptersPerDay).floor();
  
  // Pas de prise en compte versets/densit√© ‚ùå
  days.add(PlanDay(...));
}
```

### APR√àS (ReadingSizer + S√©mantique v2)

```dart
// intelligent_local_preset_generator.dart

import '../services/reading_sizer.dart';

Future<List<PlanDay>> _generateIntelligentDays({
  required String book,
  required int totalChapters,
  required double targetMinutesPerDay,
}) async {
  // √âTAPE 1: G√©n√©rer plan brut avec ReadingSizer
  final rawPlan = ReadingSizer.generateReadingPlan(
    book: book,
    totalChapters: totalChapters,
    targetMinutesPerDay: targetMinutesPerDay,
  );

  final days = <PlanDay>[];
  
  // √âTAPE 2: Ajuster chaque jour avec S√©mantique v2
  for (final rawDay in rawPlan) {
    final adjusted = SemanticPassageBoundaryService.adjustPassageVerses(
      book: rawDay['book'] as String,
      startChapter: rawDay['startChapter'] as int,
      startVerse: 1,
      endChapter: rawDay['endChapter'] as int,
      endVerse: ChapterIndexLoader.verseCount(
        rawDay['book'] as String,
        rawDay['endChapter'] as int,
      ),
    );

    // √âTAPE 3: R√©-estimer temps apr√®s ajustement
    final finalMinutes = ChapterIndexLoader.estimateMinutesRange(
      book: adjusted.book,
      startChapter: adjusted.startChapter,
      endChapter: adjusted.endChapter,
    );

    days.add(PlanDay(
      dayNumber: rawDay['dayNumber'] as int,
      reference: adjusted.reference,
      book: adjusted.book,
      startChapter: adjusted.startChapter,
      endChapter: adjusted.endChapter,
      estimatedMinutes: finalMinutes,
      annotation: adjusted.includedUnit?.name,
      hasLiteraryUnit: adjusted.adjusted,
      unitType: adjusted.includedUnit?.type.name,
      unitPriority: adjusted.includedUnit?.priority.name,
      // ...
    ));
  }

  return days;
}
```

**R√©sultat** :
- ‚úÖ Temps pr√©cis (ReadingSizer + ChapterIndex)
- ‚úÖ Coh√©rence s√©mantique (v2.0)
- ‚úÖ Estimation finale ajust√©e

---

## üß™ EXEMPLES COMPLETS

### Exemple 1 : Preview plan dans UI

```dart
// Dans CreatePlanPage

class _CreatePlanPageState extends State<CreatePlanPage> {
  String selectedBook = 'Luc';
  int totalChapters = 24;
  double minutesPerDay = 10;

  @override
  Widget build(BuildContext context) {
    // G√©n√©rer preview
    final preview = ReadingSizer.generateReadingPlan(
      book: selectedBook,
      totalChapters: totalChapters,
      targetMinutesPerDay: minutesPerDay,
    );

    final stats = ReadingSizer.planStats(preview);

    return Column(
      children: [
        // Inputs...
        
        // Preview
        Card(
          child: Padding(
            padding: EdgeInsets.all(16),
            child: Column(
              children: [
                Text('üìä Aper√ßu du plan',
                  style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold)),
                SizedBox(height: 12),
                _statRow('Dur√©e', '${stats['totalDays']} jours'),
                _statRow('Temps total', '~${stats['totalMinutes'] ~/ 60}h'),
                _statRow('Moyenne', '${stats['avgMinutesPerDay']} min/jour'),
                _statRow('Jour le plus court', 
                  '${stats['minDay']['range']} (~${stats['minDay']['approxMinutes']} min)'),
                _statRow('Jour le plus long', 
                  '${stats['maxDay']['range']} (~${stats['maxDay']['approxMinutes']} min)'),
              ],
            ),
          ),
        ),
        
        // Liste jours
        Expanded(
          child: ListView.builder(
            itemCount: preview.length,
            itemBuilder: (context, index) {
              final day = preview[index];
              return ListTile(
                leading: CircleAvatar(child: Text('${day['dayNumber']}')),
                title: Text(day['range'] as String),
                subtitle: Text('~${day['approxMinutes']} min'),
                trailing: Icon(Icons.chevron_right),
              );
            },
          ),
        ),
      ],
    );
  }

  Widget _statRow(String label, String value) {
    return Padding(
      padding: EdgeInsets.symmetric(vertical: 4),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: [
          Text(label, style: TextStyle(color: Colors.grey)),
          Text(value, style: TextStyle(fontWeight: FontWeight.w600)),
        ],
      ),
    );
  }
}
```

---

### Exemple 2 : Sugg√©rer dur√©e optimale

```dart
// Dans l'UI de cr√©ation de plan

Widget _suggestDuration() {
  final suggested = ReadingSizer.estimateDaysForBook(
    book: selectedBook,
    totalChapters: totalChapters,
    targetMinutesPerDay: minutesPerDay,
  );

  return Card(
    color: Colors.blue.shade50,
    child: Padding(
      padding: EdgeInsets.all(12),
      child: Row(
        children: [
          Icon(Icons.lightbulb_outline, color: Colors.blue),
          SizedBox(width: 8),
          Expanded(
            child: Text(
              'Dur√©e sugg√©r√©e: $suggested jours pour $selectedBook '
              'avec ${minutesPerDay.round()} min/jour',
              style: TextStyle(color: Colors.blue.shade900),
            ),
          ),
          TextButton(
            onPressed: () {
              setState(() {
                targetDays = suggested;
              });
            },
            child: Text('Appliquer'),
          ),
        ],
      ),
    ),
  );
}
```

---

## üìä COMPARAISON AVANT/APR√àS

### Sc√©nario : Luc (24 chapitres, 10 min/jour)

**AVANT** (approximation uniforme) :
```
24 chap / 40 jours = 0.6 chap/jour
Tous chapitres = 25 versets
Tous chapitres = densit√© 1.0

Jour 1 : Luc 1 ‚Üí Estim√©: ~6 min | R√©el: ~14 min ‚ùå (+133%)
Jour 15 : Luc 15:1-10 ‚Üí Estim√©: ~8 min | R√©el: ~6 min ‚ùå (coup√©)
Jour 40 : Luc 24 ‚Üí Estim√©: ~6 min | R√©el: ~11 min ‚ùå (+83%)

Pr√©cision: ¬±50%
Coh√©rence: 65%
```

**APR√àS** (ReadingSizer + S√©mantique v2) :
```
ReadingSizer calcule versets + densit√© r√©els
S√©mantique v2 ajuste unit√©s litt√©raires

Jour 1 : Luc 1 ‚Üí Estim√©: ~14 min | R√©el: ~13 min ‚úÖ (+7%)
Jour 15 : Luc 15:1-32 ‚Üí Estim√©: ~10 min | R√©el: ~11 min ‚úÖ (+10%)
Jour 24 : Luc 24 ‚Üí Estim√©: ~11 min | R√©el: ~10 min ‚úÖ (-9%)

Pr√©cision: ¬±10%
Coh√©rence: 98%
```

---

## üéØ AVANTAGES

| Aspect | Valeur |
|--------|--------|
| **Offline** | ‚úÖ 100% local |
| **Pr√©cis** | ‚úÖ ¬±10% (vs ¬±50% avant) |
| **Personnalisable** | ‚úÖ Vitesse lecture |
| **Coh√©rent** | ‚úÖ Combine avec S√©mantique v2 |
| **UI-friendly** | ‚úÖ R√©sum√©s pr√™ts √† afficher |
| **Stats** | ‚úÖ M√©triques compl√®tes |

---

## ‚úÖ CHECKLIST INT√âGRATION

### Installation
- [ ] Cr√©er `reading_sizer.dart`
- [ ] V√©rifier import `chapter_index_loader.dart`

### Tests
- [ ] Test `estimateChaptersForDay()` ‚Üí 2 pour Luc/10min
- [ ] Test `generateReadingPlan()` ‚Üí 24 jours pour Luc
- [ ] Test `planStats()` ‚Üí stats coh√©rentes

### Int√©gration g√©n√©rateur
- [ ] Remplacer calcul approximatif par `generateReadingPlan()`
- [ ] Combiner avec `adjustPassageVerses()`
- [ ] R√©-estimer apr√®s ajustement s√©mantique

### UI
- [ ] Preview plan dans CreatePlanPage
- [ ] Sugg√©rer dur√©e optimale
- [ ] Stats plan (min/max/moyenne)

---

## üöÄ PROCHAINES √âTAPES

1. ‚úÖ Int√©grer ReadingSizer dans g√©n√©rateur
2. ‚úÖ Tester sur 5 livres diff√©rents
3. ‚úÖ UI preview plan
4. ‚úÖ Calibrer baseMinutes selon feedback users

---

**üìè READING SIZER OP√âRATIONNEL ! CALCUL INTELLIGENT CHARGE DE LECTURE ! üéØ‚ú®**

